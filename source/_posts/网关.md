---
title: "网关"
date: 2024-07-23
description: ""
cover: https://github.com/Gjt-9520/Resource/blob/main/Bimage-135/Bimage71.jpg?raw=true
tags: ["微服务","SpringCloud","Gateway","OpenFeign"]
category: "学习笔记"
updated: 2024-07-24
  
top_group_index: 
---

# 网关

网关就是网络的关口,负责请求的**路由、转发、身份校验**

![网关](../images/网关.png)

SpringCloud中网关的实现包括两种:

1. **Spring Cloud Gateway**
- Spring官方出品
- 基于WebFlux响应式编程
- 无需调优即可获得优异性能

2. **Netfilx Zuul**
- Netflix出品
- 基于Servlet的阻塞式编程
- 需要调优才能获得与SpringCloudGateway类似的性能

# 网关路由

## 快速入门

![网关路由快速入门](../images/网关路由快速入门.png)

1. 创建网关模块hm-gateway并引入网关相关的依赖

```xml
<!--common-->
<dependency>
    <groupId>com.heima</groupId>
    <artifactId>hm-common</artifactId>
    <version>1.0.0</version>
</dependency>
<!--网关-->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-gateway</artifactId>
</dependency>
<!--nacos discovery-->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>
<!--负载均衡-->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-loadbalancer</artifactId>
</dependency>
```

2. 编写启动类

```java
package com.hmall.gateway;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class GatewayApplication {
    public static void main(String[] args) {
        SpringApplication.run(GatewayApplication.class, args);
    }
}
```

3. 配置路由规则

```yaml
server:
  port: 8080
spring:
  application:
    name: gateway
  cloud:
    nacos:
      server-addr: 192.168.149.127:8848
    gateway:
      routes:
        - id: item-service # 商品管理
          uri: lb://item-service
          predicates:
            - Path=/items/**,/search/**
        - id: cart-service # 购物车管理
          uri: lb://cart-service
          predicates:
            - Path=/carts/**
        - id: user-service # 用户管理
          uri: lb://user-service
          predicates:
            - Path=/users/**,/addresses/**
        - id: trade-service # 交易管理
          uri: lb://trade-service
          predicates:
            - Path=/orders/**
        - id: pay-service # 支付管理
          uri: lb://pay-service
          predicates:
            - Path=/pay-orders/**
```

## 路由属性

**网关路由**对应的Java类型是RouteDefinition,其中常见的属性有:

- id:路由唯一标示
- uri:路由目标地址
- predicates:路由断言,判断请求是否符合当前路由
- filters:路由过滤器,对请求或响应做特殊处理。

### 路由断言

![路由断言](../images/12种基本的RoutePredicateFactory实现.png)

### 路由过滤器

![路由过滤器](../images/33种路由过滤器.png)

# 网关登录校验

## 思路分析

## 自定义GlobalFilter

## 自定义GatewayFilter

## 实现登录校验

## 网关传递用户到微服务

## OpenFeign传递用户信息

# 配置管理

## 共享配置

## 配置热更新

## 动态路由



