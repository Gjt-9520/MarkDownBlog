---
title: "分布式任务处理"
date: 2024-08-18
description: ""
cover: https://github.com/Gjt-9520/MarkDownBlog/blob/main/source/coverImages/Bimage-135/Bimage108.jpg?raw=true
tags: ["SpringBoot", "XXL-JOB"]
category: "微服务"
updated: 2024-08-19
  
top_group_index: 
---

# 分布式任务调度

对一个视频的转码可以理解为一个任务的执行,如果视频的数量比较多,如何去高效处理一批任务呢?

1. 多线程
多线程是充分利用单机的资源

2. 分布式加多线程
充分利用多台计算机,每台计算机使用多线程处理

方案2可扩展性更强,这就是一种分布式任务调度的处理方案

**任务调度**就是对任务的调度,它是指系统为了完成特定业务,基于给定时间点,给定时间间隔或者给定执行次数自动执行任务

通常任务调度的程序是集成在应用中的,比如:优惠卷服务中包括了定时发放优惠卷的的调度程序,结算服务中包括了定期生成报表的任务调度程序,由于采用分布式架构,一个服务往往会部署多个冗余实例来运行业务,在这种分布式系统环境下运行任务调度,被称之为**分布式任务调度**

# 分布式调度要实现的目标

不管是任务调度程序集成在应用程序中,还是单独构建的任务调度系统,如果采用分布式调度任务的方式就相当于将任务调度程序分布式构建,这样就可以具有分布式系统的特点,并且提高任务的调度处理能力:

1. **并行任务调度**
    
    并行任务调度实现靠多线程,如果有大量任务需要调度,此时光靠多线程就会有瓶颈了,因为一台计算机CPU的处理能力是有限的,如果将任务调度程序分布式部署,每个结点还可以部署为集群,这样就可以让多台计算机共同去完成任务调度,可以将任务分割为若干个分片,由不同的实例并行执行,来提高任务调度的处理效率

2. **高可用**

    若某一个实例宕机,不影响其他实例来执行任务

3. **弹性扩容**
    
    当集群中增加实例就可以提高并执行任务的处理效率

4. **任务管理与监测**

    对系统中存在的所有定时任务进行统一的管理及监测,让开发人员及运维人员能够时刻了解任务执行情况,从而做出快速的应急处理响应

5. **避免任务重复执行**

    当任务调度以集群方式部署,同一个任务调度可能会执行多次,比如在上面提到的电商系统中到点发优惠券的例子,就会发放多次优惠券,对公司造成很多损失,所以需要控制相同的任务在多个运行实例上只执行一次

# XXL-JOB

[XXL-JOB官方网站](https://www.xuxueli.com/xxl-job/)

![XXL-JOB](../images/XXL-JOB.png)

- 调度中心:
    负责管理调度信息,按照调度配置发出调度请求,自身不承担业务代码
    主要职责为执行器管理、任务管理、监控运维、日志管理等

- 任务执行器:
    负责接收调度请求并执行任务逻辑
    只要职责是注册服务、任务执行服务（接收到任务后会放入线程池中的任务队列）、执行结果上报、日志服务等

- 任务:负责执行具体的业务处理

![XXL-JOB任务执行流程](../images/XXL-JOB任务执行流程.png)

执行流程:
1. 任务执行器根据配置的调度中心的地址,自动注册到调度中心
2. 达到任务触发条件,调度中心下发任务
3. 执行器基于线程池执行任务,并把执行结果放入内存队列中、把执行日志写入日志文件中
4. 执行器消费内存队列中的执行结果,主动上报给调度中心
5. 当用户在调度中心查看任务日志,调度中心请求任务执行器,任务执行器读取任务日志文件并返回日志详情

## 搭建

[XXL-JOB调度中心 Github仓库](https://github.com/xuxueli/xxl-job)










